redChat.controller("chatController",["$scope","socket","chatService","smoothScroll","$location",function(e,o,r,a,s){e.userObj={},e.onlineUsers=[],e.messages=[],e.chatService=r,e.url=s.absUrl(),e.room=s.path().replace("/",""),localStorage.user||(localStorage.user=angular.toJson([]));var n=angular.fromJson(localStorage.user);n.forEach(function(r,a){e.room==r.room?(o.emit("set-user",r),e.userObj=r):r.created+1728e5<(new Date).getTime()&&(n.splice(a,1),localStorage.user=angular.toJson(n))}),o.emit("join-room",e.room),o.on("messages-history",function(o){o.forEach(function(e){t(e)}),e.messages=o}),o.on("message",function(o){t(o),e.messages.push(o)}),o.on("online-users",function(o){e.onlineUsers=o}),o.on("set-user",function(o){var r=-1;n.forEach(function(o,a){e.room==o.room&&(r=a)}),e.userObj=o,o.created=(new Date).getTime();var a=angular.fromJson(localStorage.user);-1==r?(a.push(o),localStorage.user=angular.toJson(a)):(a[r]=o,localStorage.user=angular.toJson(a))}),e.sendMessage=function(r){o.emit("message",{text:r}),e.messageInput=""},e.changeName=function(r){e.userObj.username=r,e.userObj.real=!0,o.emit("set-user",e.userObj)};var t=function(o){o.sender.id==e.userObj.id&&(o.sender.username="You")}}]),redChat.controller("homeController",["$scope","$location",function(e,o){e.createRoom=function(){var e=Math.floor(1e6*Math.random());o.path(e)}}]);